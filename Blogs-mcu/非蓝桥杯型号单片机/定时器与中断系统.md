## 定时器
>  不要随意暂停终端服务函数(TR0)和改变中断服务函数的中断时长(原1ms)，因为中断服务函数关系到按键检测和各种数据的显示。
若随意更改中断初始化函数可能导致按键只响应一次，数码管随机显示某一位数据，延时过长等后果。


#### 定时器框架
![img](https://img2023.cnblogs.com/blog/3583913/202502/3583913-20250225223603604-1758140255.png)

#### 定时器的工作模式
![img](https://img2023.cnblogs.com/blog/3583913/202503/3583913-20250310101852437-1197809492.png)
![img](https://img2023.cnblogs.com/blog/3583913/202502/3583913-20250225225737464-1517119091.png)

#### 定时器时钟
![img](https://img2023.cnblogs.com/blog/3583913/202502/3583913-20250225225704522-1463791542.png)

#### 定时器的中断服务函数
>定义中断服务函数：
 函数类型 函数名 (形式参数) interrupt n [using n]
中断号    中断源         中断向量
  0     外部中断0           0003H
  1     定时器/计数器0      000BH
  2     外部中断1           0013H
  3     定时器/计数器1      001BH
  4     串行口              0023H
interrupt 关键字是不可缺少的，由它告诉编译器该函数是中断服务函数，并由后面的
n 指明所使用的中断号。n 的取值范围为0-31,但具体的中断号要取决于芯片的型号，像
AT89C51 实际上就使用0-4 号中断。每个中断号都对应一个中断向量，具体地址为8n+3,
中断源响应后处理器会跳转到中断向量所处的地址执行程序，编译器会在这地址上产生一个
无条件跳转语句，转到中断服务函数所在的地址执行程序。

#### 定时器寄存器
![img](https://img2023.cnblogs.com/blog/3583913/202502/3583913-20250225230038582-1664122492.png)

#### 定时器与中断系统
![img](https://img2023.cnblogs.com/blog/3583913/202502/3583913-20250225230353032-1478307916.png)

#### 定时器初始化的代码模板
```cpp
/* 定时器0中断初始化函数 */
void Timer0Init(void)		//1毫秒@12.000MHz
{
	AUXR &= 0x7F;		//定时器时钟12T模式
	TMOD &= 0xF0;	  //设置定时器模式
	TL0 = 0x18;		  //设置定时初始值
	TH0 = 0xFC;		  //设置定时初始值
	TF0 = 0;		    //清除TF0标志
	TR0 = 1;		    //定时器0开始计时
       //以下两句需要额外添加
  ET0 = 1;    //定时器中断0打开
	EA = 1;     //总中断打开
}
```